# 스크립트 레코드 작성하기

PerfOne을 실행한 후 스크립트를 작성합니다. 스크립트 작성은, 스크립트 레코더를 통해서 수행됩니다. 아래의 순서대로 레코더 작성을 진행합니다.

## 스크립트 레코더 작성 준비

1. `스크립트 레코더` 실행을 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 스크립트 레코더 실행

    TASK: [스크립트 작성] - [레코더 실행]

    KEY : [Alt] + [R] + [N]
   ```

2. `스크립트 작성`을 위해 다음작업을 수행합니다

   ```erlang
    Manual Guide of 스크립트 작성

    TASK: [파일] - [새로 만들기]

    KEY : [Ctrl] + [N]
   ```

3. `스크립트 저장장소 지정`을 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 스크립트 저장장소 지정

    TASK: [저장할 폴더 선택] - [OK 버튼 클릭]

    INFO: 저장폴더는 Documents 폴더가 기본 폴더입니다.
   ```

4. `스크립트명 작성`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 스크립트명 작성

    TASK: [스크립트 이름 작성] - [확인 버튼 클릭]

    INFO: 스크립트명은 영문, 숫자를 권장하며, 한글명은 권장하지 않습니다.
   ```

5. `피들러 설치`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 피들러 설치

    TASK: [ 피들러 설치 경고 메세지 확인 ] - [YES 버튼 클릭]

    INFO: 
    * 피들러란: 피들러는 스크립트 작성에 필요한 패킷 스니핑 툴 입니다.
    피들러는 스크립트 작성을 위해 임시로 설치되는 툴이므로, 
    스크립트 작성이 종료되면 자동 삭제 되도록 설정되어 있습니다. 
    피들러 설치 경고 메세지를 확인 후, YES 버튼을 클릭하면 피들러가 설치 됩니다.
   ```

## 스크립트 레코더 작성 진행

1. `트랜잭션 추가`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 트랜잭션 추가

    TASK: [트랜잭션 추가 버튼 클릭] - [ 트랜잭션 이름 타이핑 ] - [ 확인 버튼 클릭 ]

    INFO: 트랜잭션이란, 네트워크 요청 과 응답 작업수행의 단위 입니다. 
    트랜잭션의 예시로, '로그인','로그아웃','파일업로드' 등등이 있습니다.
    적절한 트랜잭션의 이름을 작성하고 확인 버튼을 클릭하면 됩니다.
   ```

   ```erlang
    Tutorial Guide of 트랜잭션 추가

    튜토리얼 에서는 HOME 이라는 트랜잭션을 추가하도록 하겠습니다.
   ```

2. `트랜잭션 녹화`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 트랜잭션 녹화

    TASK: [시작 버튼 클릭] - [ 인터넷 or 서버 작업 수행 ] - [ 일시 중지 버튼 클릭 ]

    INFO: 트랜잭션 시작버튼을 누르면, 앞서 설치된 피들러 프로그램이 패킷 정보를 수집하기 시작합니다. 
    트랜잭션 시작 버튼을 누른 후, 서버에 요청을 보내면 자동으로 패킷정보가 수집됩니다. 
    서버에 보내는 요청은, '검색 요청', '로그인 버튼 클릭 요청' 등등 다양합니다.
    [ 일시 중지 버튼 ]을 클릭하면, 수집된 패킷정보가 트랜잭션에 저장됩니다.
   ```

   ```erlang
    Tutorial Guide of 트랜잭션 녹화 1

    INFO: 트랜잭션 녹화를 위해, [ 시작 버튼 클릭 ] 이후, 
    인터넷 주소창에 [http://www.gridone.co.kr/] 을 입력 후,
    [일시중지 버튼 클릭] 하여 HOME 트랜잭션 생성을 완료합니다.
   ```

   ```erlang
    Tutorial Guide of 트랜잭션 녹화 2

    INFO: 앞선 작업을 통해, HOME 트랜잭션이 생성되었습니다. 같은 방식으로, 
    LOGIN 트랜잭션을 생성합니다. LOGIN 트랜잭션은, 홈 화면에서 [ 로그인 페이지 접속 ] - [아이디, 패스 워드 입력 ] - [ 로그인 버튼 클릭 ] 의 작업을 녹화하도록 합니다.
   ```

   ```erlang
    Tutorial Guide of 트랜잭션 녹화 3

    INFO: 앞선 작업을 통해, LOGIN 트랜잭션이 생성되었습니다. 같은 방식으로, 
    LOGOUT 트랜잭션을 생성합니다. LOGOUT 트랜잭션은,  로그인 화면에서 [ 로그아웃 버튼 클릭 ]의 작업을 녹화하도록 합니다.
   ```

3. `트랜잭션 녹화 종료`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 트랜잭션 녹화 종료

    TASK: [ 종료 버튼 클릭 ] - [피들러 삭제 안내 메세지 확인 ] - [YES 버튼 클릭] - [ 컴파일 완료 안내 메세지 확인 ] - [ 확인 버튼 클릭 ]

    INFO: 트랜잭션 녹화 종료 버튼 클릭을 하게 되면, 스크렙트 레코더과 종료 됨게 동시에, 피들러 삭제 안내메세지가 나타난다. 피들러는 패킷 스니핑 툴이므로 스크립트 레코딩이 종료된 이후 삭제하는것을 권장한다. YES 버튼 클릭 하면 피들러는 자동적으로 삭제 된다. 이후, 컴파일 완료 메세지를 확인후 확인 버튼을 누르면 트랜잭션 녹화가 종료된다.
   ```

## 스크립트 레코드 결과 검증 진행

1. `트랜잭션 하위 액션 검증 및 불필요한 액션 제거`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 스크립트 레코드 결과 검증 

    TASK: [ 트랜잭션 하위에 저장된 액션 확인 ] - [ 불필요한 액션이라 판단될 경우 제거 한다 ] - [ 제거 방법: 액션 클릭 - 마우스 우클릭 - 제거 클릭 ] 

    INFO: 
    * 스크립트 레코드 결과 창 확인: 스크립트 화면에서 좌측 패널에서, 트랜잭션과 트랜잭션에 액션들이 저장되어 있음을 확인 할 수 있다.
    * 불필요한 액션 제거: 스크립트 레코딩 도중에, 불필요한 액션들까지 레코딩 되는 경우가 발생하는데, 
    측정대상이 아닌 아닌 액션들은 제거를 한다. 
    만약, 구글이나 네이버 같은 외부 서버의 액션을 제거하지 않고, 성능측정을 시도한다면, 
    해당 업체는 성능 측정자를 공격대상으로 인지하여, 
    접속 차단을 할 수 있으니 이를 예방하기위해 불필요한 액션은 제거하도록 한다.  
    * 액션이란: 액션은 GET, POST와 같은 요청 메세지를 의미한다.
   ```

2. `검증 시작`하기 위해 다음 작업을 수행합니다.

   ```erlang
    Manual Guide of 검증 시작

    TASK: 
    [ 검증 클릭] - [ 검증 시작 클릭] - [ 검증 프로토콜 선택 - 클릭 ] - [ 검증 완료 - 확인 버튼 클릭 ]

    INFO: 
    * 검증 프로토콜 선택: 검증 프로토콜은 NHTTP로 선택한다.
    검증을 시작하게되면 저장된 트랜잭션을 검사하게 된다. 이때 검증 결과 화면에서 노란색으로 표시된 부분은...
    * 노란색 영역 의미: 채워넣어야 할 내용
   ```

## 스크립트 레코더 대기 시간 설정

1. `트랜잭션간 대기시간 설정` 하기 위해 다음 작업을 수행 합니다.

   ```erlang
    Manual Guide of 트랜잭션간 대기시간 설정
    TASK: [ 트랜잭션 목록에서 트랜잭션 클릭 ] - [대기시간 클릭] - [시간입력 및 환인 클릭]
    INFO: 
    * 대기 시간 넣는 이유:  실제 사용환경을 시뮬레이션하기위해 트랜잭션간에 Think Time을 넣어 준다.
    * Think TIme 의미: Think Time(생각시간)이란, 실제 사용자가 다음 작업에 넘어가는데 걸리는 시간을 의미한다.
   ```

## 스크립트 레코더 이니셜라이져 설정

1. `이니셜 라이져 설정` 하기 위해 다음 작업을 수행 합니다.

   ```erlang
   Manual Guide of 이니셜 라이져 설정

   TASK: [ 트랜잭션 목록에서 initialize 클릭 ] - [우측 패널의 스크립트 클릭] - [ 스크립트 코드 수정 ] - [ 적용 버튼 클릭 ]

   TIP:
   * 스크립트 예시 코드 위치: C:\PerfOne\PerfOne-Deps\script-examples\replace_data_source 
   * 치환 데이터 파일 저장 위치: C:\PerfOne\Controller\priv\replace 
   
   INFO: 
   * initialize: 이니셜라이즈는 트랜잭션 수행의 초기 설정을 정의 합니다. 이니셜 라이즈의 스크립트를 수정하여, 설정을 변경할수 있습니다.
   * replace data(치환 데이터) 는 csv 파일 형식으로 저장 하며, 이 파일은 replace_data_source 모듈의 함수의 인자값으로 사용된다. 


   
   ```
   ```erlang
   Tutorial Guide of 이니셜 라이져 설정

   INFO: 튜토리얼에서는, 아래와 같은 샘플 코드를 스크립트 코드에 입력하겠습니다.

   SAMPLE SCRIPT CODE:
   
   put(length_info, {1, 2, big_header}),
   replace_data_source:set_unique("data.csv"),
   replace_data_source:when_out_of_values("data.csv",restart),
   next.

   % set_unique : 데이터 중복 방지를 위한 unique 설정 한다.
   % when_out_of_values: value값이 모두 처리되었을 경우 처리방식을 설정한다. 예시코드에선 'restart' 로 설정되어있다.
   % 처리방식 : abort, last, restart(default:restart) 등이 있다.


   ```

## 스크립트 레코더 치환변수 설정

1. `치환 변수 설정` 하기 위해 다음 작업을 수행 합니다.

   ```erlang
   Manual Guide of 치환 변수 설정

   TASK: [ 트랜잭션 목록에서 치환변수를 적용할 트랜잭션 클릭 ] - [스크립트 클릭] - [ 스크립트 코드 작성 ] - [ 적용 버튼 클릭 ]

   INFO: 
   * 치환데이터는 트랜잭션에 적용될 데이터이다. 
   * 사용예시(로그인 트랜잭션의 경우): 로그인 트랜잭션에서는 로그인 데이터 정보가 필요하므로 로그인 정보를 치환변수에 저장하여 사용한다.

   SAMPLE SCRIPT CODE: 
   replace_data_source:fetch_next_row("data.csv"),
   id = replace_data_source:get_value("ID","data.csv"),
   pwd = replace_data_source:get_value("PWD","data.csv"),
      
   ```
   ```erlang
   Tutorial Guide of 치환 변수 설정

   INFO: 튜토리얼에서는, 아래와 같은 샘플 코드를 스크립트 코드에 입력하겠습니다.

   SAMPLE SCRIPT CODE:
   replace_data_source:fetch_next_row("data.csv"),
   id = replace_data_source:get_value("ID","data.csv"),
   pwd = replace_data_source:get_value("PWD","data.csv"),

   % fetch_next_row : data.csv 파일로 부터 row 값을 가져옵니다.
   % get_value  : data.csv 파일로 부터 값을 가져옵니다.


   ```

2. `치환 변수 설정 적용` 하기 위해 다음 작업을 수행 합니다.

   ```erlang
   Manual Guide of 치환 변수 설정

   TASK: [ 트랜잭션 목록에서 치환변수를 적용할 액션클릭 ] - [ 치환 변수가 적용될 영역 클릭 ] - [ 스크립트 코드 작성 ] - [ 적용 버튼 클릭 ]

   INFO: 
   * 예시코드에서는, [ 로그인 트랜잭션 ]- [ POST 액션 ] - [ Message Body 영역 코드 수정 ] 의 코드 내용을 보여준다.

   SAMPLE SCRIPT CODE: 
   "username="++ id ++ "&" ++ "password=" ++ pwd ++ []

   ```



## 최종 점검 및 저장 

1. `최종 점검 및 저장 ` 하기 위해 다음 작업을 수행 합니다.

   ```erlang
    Manual Guide of 최종 점검 및 저장 
   
    INFO: 변경사항 적용이 완료되었다면, 앞선 검증 과정을 다시 한번 진행한 이후 저장을 하고, 스크립트 레코더를 종료합니다.
    
   ```